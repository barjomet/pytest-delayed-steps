


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>pytest_steps</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytest-steps" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="pytest_steps" class="md-header-nav__button md-logo" aria-label="pytest_steps">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            pytest_steps
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Home
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/smarie/python-pytest-steps/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="pytest_steps" class="md-nav__button md-logo" aria-label="pytest_steps">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    pytest_steps
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/smarie/python-pytest-steps/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-usage-generator-mode" class="md-nav__link">
    1. Usage - "generator" mode
  </a>
  
    <nav class="md-nav" aria-label="1. Usage - "generator" mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-basics" class="md-nav__link">
    a- Basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-shared-data" class="md-nav__link">
    b- Shared data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-optional-steps-and-dependencies" class="md-nav__link">
    c- Optional steps and dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-calling-decorated-functions-manually" class="md-nav__link">
    d- Calling decorated functions manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-compliance-with-pytest" class="md-nav__link">
    e- Compliance with pytest
  </a>
  
    <nav class="md-nav" aria-label="e- Compliance with pytest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixtures" class="md-nav__link">
    fixtures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-usage-explicit-mode" class="md-nav__link">
    2. Usage - "explicit" mode
  </a>
  
    <nav class="md-nav" aria-label="2. Usage - "explicit" mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-basics_1" class="md-nav__link">
    a- Basics
  </a>
  
    <nav class="md-nav" aria-label="a- Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variants-other-types" class="md-nav__link">
    Variants: other types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-auto-skipfail" class="md-nav__link">
    b- Auto-skip/fail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-shared-data" class="md-nav__link">
    c- Shared data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-calling-decorated-functions-manually_1" class="md-nav__link">
    d- Calling decorated functions manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-compliance-with-pytest_1" class="md-nav__link">
    e- Compliance with pytest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-usage-with-pytest-harvest" class="md-nav__link">
    3. Usage with pytest-harvest
  </a>
  
    <nav class="md-nav" aria-label="3. Usage with pytest-harvest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-enhancing-the-results-df" class="md-nav__link">
    a- Enhancing the results df
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-pivoting-the-results-df" class="md-nav__link">
    b- Pivoting the results df
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-examples" class="md-nav__link">
    c- Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="api_reference/" title="API reference" class="md-nav__link">
      API reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-usage-generator-mode" class="md-nav__link">
    1. Usage - "generator" mode
  </a>
  
    <nav class="md-nav" aria-label="1. Usage - "generator" mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-basics" class="md-nav__link">
    a- Basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-shared-data" class="md-nav__link">
    b- Shared data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-optional-steps-and-dependencies" class="md-nav__link">
    c- Optional steps and dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-calling-decorated-functions-manually" class="md-nav__link">
    d- Calling decorated functions manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-compliance-with-pytest" class="md-nav__link">
    e- Compliance with pytest
  </a>
  
    <nav class="md-nav" aria-label="e- Compliance with pytest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixtures" class="md-nav__link">
    fixtures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-usage-explicit-mode" class="md-nav__link">
    2. Usage - "explicit" mode
  </a>
  
    <nav class="md-nav" aria-label="2. Usage - "explicit" mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-basics_1" class="md-nav__link">
    a- Basics
  </a>
  
    <nav class="md-nav" aria-label="a- Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variants-other-types" class="md-nav__link">
    Variants: other types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-auto-skipfail" class="md-nav__link">
    b- Auto-skip/fail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-shared-data" class="md-nav__link">
    c- Shared data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-calling-decorated-functions-manually_1" class="md-nav__link">
    d- Calling decorated functions manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-compliance-with-pytest_1" class="md-nav__link">
    e- Compliance with pytest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-usage-with-pytest-harvest" class="md-nav__link">
    3. Usage with pytest-harvest
  </a>
  
    <nav class="md-nav" aria-label="3. Usage with pytest-harvest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-enhancing-the-results-df" class="md-nav__link">
    a- Enhancing the results df
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-pivoting-the-results-df" class="md-nav__link">
    b- Pivoting the results df
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-examples" class="md-nav__link">
    c- Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features-benefits" class="md-nav__link">
    Main features / benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-pytest-steps/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="pytest-steps">pytest-steps<a class="headerlink" href="#pytest-steps" title="Permanent link">&para;</a></h1>
<p><em>Create step-wise / incremental tests in <code>pytest</code>.</em></p>
<p><a href="https://pypi.python.org/pypi/pytest-steps/"><img alt="Python versions" src="https://img.shields.io/pypi/pyversions/pytest-steps.svg" /></a> <a href="https://travis-ci.org/smarie/python-pytest-steps"><img alt="Build Status" src="https://travis-ci.org/smarie/python-pytest-steps.svg?branch=master" /></a> <a href="https://smarie.github.io/python-pytest-steps/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-pytest-steps/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-pytest-steps"><img alt="codecov" src="https://codecov.io/gh/smarie/python-pytest-steps/branch/master/graph/badge.svg" /></a></p>
<p><a href="https://smarie.github.io/python-pytest-steps/"><img alt="Documentation" src="https://img.shields.io/badge/doc-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/pytest-steps/"><img alt="PyPI" src="https://img.shields.io/pypi/v/pytest-steps.svg" /></a> <a href="https://pepy.tech/project/pytest-steps"><img alt="Downloads" src="https://pepy.tech/badge/pytest-steps" /></a> <a href="https://pepy.tech/project/pytest-steps"><img alt="Downloads per week" src="https://pepy.tech/badge/pytest-steps/week" /></a> <a href="https://github.com/smarie/python-pytest-steps/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/smarie/python-pytest-steps.svg" /></a></p>
<div class="admonition warning">
<p class="admonition-title">Manual execution of tests has slightly changed in <code>1.7.0</code>, see explanations <a href="#d-calling-decorated-functions-manually">here</a></p>
</div>
<div class="admonition success">
<p class="admonition-title">New 'generator' style is there, <a href="#1-usage-generator-mode">check it out</a> !</p>
</div>
<div class="admonition success">
<p class="admonition-title">New <code>pytest-harvest</code> compatibility fixtures, <a href="#3-usage-with-pytest-harvest">check them out</a> !</p>
</div>
<p>Did you ever want to organize your test in incremental steps, for example to improve readability in case of failure ? Or to have some optional steps, executing only conditionally to previous steps' results?</p>
<p><code>pytest-steps</code> leverages <code>pytest</code> and its great <code>@pytest.mark.parametrize</code> and <code>@pytest.fixture</code> decorators, so that you can <strong>create incremental tests with steps</strong> without having to think about the pytest fixture/parametrize pattern that has to be implemented for your particular case. </p>
<p>This is particularly helpful if:</p>
<ul>
<li>you wish to <strong>share a state / intermediate results</strong> across test steps</li>
<li>your tests <strong>already rely on other fixtures and/or parameters</strong>, such as with <a href="https://smarie.github.io/python-pytest-cases/">pytest-cases</a>. In that case, finding the correct pytest design, that will ensure that you have a brand new state object at the beginning of each test suite while ensuring that this object will actually be shared across all steps, might be very tricky. </li>
</ul>
<p>With <code>pytest-steps</code> you don't have to care about the internals: it just works as expected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>pytest-steps</code> has not yet been tested with pytest-xdist. See <a href="https://github.com/smarie/python-pytest-steps/issues/7">#7</a></p>
</div>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>&gt; pip install pytest_steps
</code></pre></div>


<h2 id="1-usage-generator-mode">1. Usage - "generator" mode<a class="headerlink" href="#1-usage-generator-mode" title="Permanent link">&para;</a></h2>
<p>This new mode may seem more natural and readable to non-pytest experts. However it may be harder to debug when used in combination with other <code>pytest</code> tricks. In such case, do not hesitate to switch to good old <a href="#2-usage-explicit-mode">"explicit" mode</a>.</p>
<h3 id="a-basics">a- Basics<a class="headerlink" href="#a-basics" title="Permanent link">&para;</a></h3>
<p>Start with you favorite test function. There are two things to do, to break it down into steps:</p>
<ul>
<li>decorate it with <code>@test_steps</code> to declare what are the steps that will be performed, as strings. </li>
<li>insert as many <code>yield</code> statements in your function body as there are steps. The function should end with a <code>yield</code> (not <code>return</code>!). </li>
</ul>
<p>!!! note
   Code written after the last yield will not be executed. </p>
<p>For example we define three steps:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">,</span> <span class="s1">&#39;step_c&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">():</span>
    <span class="c1"># Step A</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step a&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>
    <span class="n">intermediate_a</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>
    <span class="k">yield</span>

    <span class="c1"># Step B</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>
    <span class="k">yield</span>

    <span class="c1"># Step C</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step c&quot;</span><span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">intermediate_a</span> <span class="o">+</span> <span class="s2">&quot; ... augmented&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">56</span>
    <span class="k">yield</span>
</code></pre></div>


<p>That's it! If you run <code>pytest</code> you will now see 3 tests instead of one:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts =============================
(...)
collected 3 items                                                           

(...)/test_example.py::test_suite[step_a] &lt;- &lt;decorator-gen-3&gt; PASSED [ 33%]
(...)/test_example.py::test_suite[step_b] &lt;- &lt;decorator-gen-3&gt; PASSED [ 66%]
(...)/test_example.py::test_suite[step_c] &lt;- &lt;decorator-gen-3&gt; PASSED [100%]

========================== 3 passed in 0.06 seconds ===========================
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Debugging note</p>
<p>You might wish to use <code>yield &lt;step_name&gt;</code> instead of <code>yield</code> at the end of each step when debugging if you think that there is an issue with the execution order. This will activate a built-in checker, that will check that each step name in the declared sequence corresponds to what you actually yield at the end of that step.</p>
</div>
<h3 id="b-shared-data">b- Shared data<a class="headerlink" href="#b-shared-data" title="Permanent link">&para;</a></h3>
<p>By design, all intermediate results created during function execution are shared between steps, since they are part of the same python function call. You therefore have nothing to do: this is what is shown above in step c where we reuse <code>intermediate_a</code> from step a. </p>
<h3 id="c-optional-steps-and-dependencies">c- Optional steps and dependencies<a class="headerlink" href="#c-optional-steps-and-dependencies" title="Permanent link">&para;</a></h3>
<p>In this <em>generator</em> mode, all steps <strong>depend on all previous steps</strong> by default: if a step fails, all subsequent steps will be skipped. To circumvent this behaviour you can declare a step as optional. This means that subsequent steps will not depend on it except explicitly stated. For this you should:</p>
<ul>
<li>wrap the step into the special <code>optional_step</code> context manager,</li>
<li><code>yield</code> the corresponding context object at the end of the step, instead of <code>None</code> or the step name. This is very important, otherwise the step will be considered as successful by pytest!</li>
</ul>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code>    <span class="c1"># Step B</span>
    <span class="k">with</span> <span class="n">optional_step</span><span class="p">(</span><span class="s1">&#39;step_b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">step_b</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="k">yield</span> <span class="n">step_b</span>
</code></pre></div>


<p>If steps <em>depend on an optional step</em> in order to execute, you should make them optional too, and state it explicitly:</p>
<ul>
<li>declare the dependency using the <code>depends_on</code> argument.</li>
<li>use <code>should_run()</code> to test if the code block should be executed. </li>
</ul>
<p>The example below shows 4 steps, where steps a and d are mandatory and b and c are optional with c dependent on b:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span><span class="p">,</span> <span class="n">optional_step</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">,</span> <span class="s1">&#39;step_c&#39;</span><span class="p">,</span> <span class="s1">&#39;step_d&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_opt</span><span class="p">():</span>
    <span class="c1"># Step A</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>
    <span class="k">yield</span>

    <span class="c1"># Step B</span>
    <span class="k">with</span> <span class="n">optional_step</span><span class="p">(</span><span class="s1">&#39;step_b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">step_b</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="k">yield</span> <span class="n">step_b</span>

    <span class="c1"># Step C depends on step B</span>
    <span class="k">with</span> <span class="n">optional_step</span><span class="p">(</span><span class="s1">&#39;step_c&#39;</span><span class="p">,</span> <span class="n">depends_on</span><span class="o">=</span><span class="n">step_b</span><span class="p">)</span> <span class="k">as</span> <span class="n">step_c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">step_c</span><span class="o">.</span><span class="n">should_run</span><span class="p">():</span>
            <span class="k">assert</span> <span class="kc">True</span>
    <span class="k">yield</span> <span class="n">step_c</span>

    <span class="c1"># Step D</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>
    <span class="k">yield</span>
</code></pre></div>


<p>Running it with <code>pytest</code> shows the desired behaviour: step b <strong>fails</strong> but does not prevent step d to execute correctly. step c is marked as <strong>skipped</strong> because its dependency (step b) failed. </p>
<div class="codehilite"><pre><span></span><code>============================= test session starts =============================
(...)
collected 4 items                                                              

(...)/test_example.py::test_suite_opt[step_a] &lt;- &lt;decorator-gen-3&gt; PASSED [ 25%]
(...)/test_example.py::test_suite_opt[step_b] &lt;- &lt;decorator-gen-3&gt; FAILED [ 50%]
(...)/test_example.py::test_suite_opt[step_c] &lt;- &lt;decorator-gen-3&gt; SKIPPED [ 75%]
(...)/test_example.py::test_suite_opt[step_d] &lt;- &lt;decorator-gen-3&gt; PASSED [100%]

================================== FAILURES ===================================
_______________ test_suite_optional_and_dependent_steps[step_b] _______________
(...)
================ 1 failed, 2 passed, 1 skipped in 0.16 seconds ================
</code></pre></div>


<h3 id="d-calling-decorated-functions-manually">d- Calling decorated functions manually<a class="headerlink" href="#d-calling-decorated-functions-manually" title="Permanent link">&para;</a></h3>
<p>In some cases you might wish to call your test functions manually before the tests actually run. This can be very useful when you do not wish the package import times to be counted in test execution durations - typically in a "benchmarking" use case such as shown <a href="https://smarie.github.io/pytest-patterns/examples/data_science_benchmark/">here</a>.</p>
<p>It is now possible to call a test function decorated with <code>@test_steps</code> manually. For this the best way to understand what you have to provide is to inspect it.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_dummy</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">)</span>
    <span class="k">yield</span>

<span class="nb">print</span><span class="p">(</span><span class="n">help</span><span class="p">(</span><span class="n">test_dummy</span><span class="p">))</span>
</code></pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span><code>test_dummy(________step_name_, request) 
</code></pre></div>


<p>So we have to provide two arguments: <code>________step_name_</code> and <code>request</code>. Note: the same information can be obtained in a more formal way using <code>signature</code> from the <code>inspect</code> (latest python) or <code>funcsigs</code> (older) packages.</p>
<p>Once you know what arguments you have to provide, there are two rules to follow in order to execute the function manually:</p>
<ul>
<li>replace the <code>step_name</code> argument with which steps you wish to execute: <code>None</code> to execute all steps in order, or a list of steps to execute some steps only. Note that in generator mode, "by design" (generator function) it is only possible to call the steps in correct order and starting from the first one, but you can provide a partial list:</li>
<li>replace the <code>request</code> argument with <code>None</code>, to indicate that you are executing outside of any pytest context.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span> <span class="n">test_dummy</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">hello</span>
<span class="n">world</span>

<span class="o">&gt;</span> <span class="n">test_dummy</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">hello</span>

<span class="o">&gt;</span> <span class="n">test_dummy</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Incorrect</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">steps</span> <span class="n">provided</span> <span class="k">for</span> <span class="n">manual</span> <span class="n">execution</span><span class="o">.</span> <span class="n">Step</span> <span class="c1">#1 should be named &#39;first&#39;, found &#39;second&#39;</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">arguments order changed in <code>1.7.0</code></p>
<p>Unfortunately the order of arguments for manual execution changed in version <code>1.7.0</code>. This was the only way to <a href="https://github.com/smarie/python-pytest-steps/issues/16">add support for class methods</a>. Apologies !</p>
</div>
<h3 id="e-compliance-with-pytest">e- Compliance with pytest<a class="headerlink" href="#e-compliance-with-pytest" title="Permanent link">&para;</a></h3>
<h4 id="parameters"><em>parameters</em><a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<p>Under the hood, the <code>@test_steps</code> decorator simply generates a wrapper function around your function and mark it with <code>@pytest.mark.parametrize</code>. The function wrapper is created using the excellent <a href="https://github.com/micheles/decorator"><code>decorator</code></a> library, so all marks that exist on it are kept in the process, as well as its name and signature. </p>
<p>Therefore <code>@test_steps</code> <strong>should be compliant with all native pytest mechanisms.</strong> For exemple you can use decorators such as <code>@pytest.mark.parametrize</code> before or after it in the function decoration order (depending on your desired resulting test order):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ids</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="s2">&quot;i=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_p</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="c1"># Step A</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step a, i=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>
    <span class="k">yield</span>

    <span class="c1"># Step B</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b, i=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>
    <span class="k">yield</span>
</code></pre></div>


<p>If you execute it, it correctly executes all the steps for each parameter value:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts =============================
(...)
collected 4 items                                                              

(...)/test_example.py::test_suite_p[i=0-step_a] &lt;- &lt;decorator-gen-3&gt; PASSED [ 25%]
(...)/test_example.py::test_suite_p[i=0-step_b] &lt;- &lt;decorator-gen-3&gt; PASSED [ 50%]
(...)/test_example.py::test_suite_p[i=1-step_a] &lt;- &lt;decorator-gen-3&gt; PASSED [ 75%]
(...)/test_example.py::test_suite_p[i=1-step_b] &lt;- &lt;decorator-gen-3&gt; PASSED [100%]
========================== 4 passed in 0.07 seconds ===========================
</code></pre></div>


<h4 id="fixtures"><em>fixtures</em><a class="headerlink" href="#fixtures" title="Permanent link">&para;</a></h4>
<p>You can also use fixtures as usual, but <strong>special care has to be taken about function-scope fixtures</strong>. Let's consider the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">usage_counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">my_fixture</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Simple function-scoped fixture that return a new instance each time&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">usage_counter</span>
    <span class="n">usage_counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;created my_fixture </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">usage_counter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">usage_counter</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_one_fixture_per_step</span><span class="p">(</span><span class="n">my_fixture</span><span class="p">):</span>
    <span class="c1"># Step A</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step a&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">my_fixture</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">yield</span>

    <span class="c1"># Step B</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">my_fixture</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># &gt;&gt; raises an AssertionError because my_fixture = 1 !</span>
    <span class="k">yield</span>
</code></pre></div>


<p>Here, and that can be a bit misleading, </p>
<ul>
<li><code>pytest</code> will call <code>my_fixture()</code> twice, because there are two pytest function executions, one for each step. So we think that everything is good...</li>
<li>...however the second fixture instance is never be passed to our test code: instead, the <code>my_fixture</code> instance that was passed as argument in the first step will be used by all steps. Therefore we end up having a failure in the test furing step b.</li>
</ul>
<p>It is possible to circumvent this behaviour by declaring explicitly what you expect:</p>
<ul>
<li>if you would like to share fixture instances across steps, decorate your fixture with <code>@cross_steps_fixture</code>.</li>
<li>if you would like each step to have its own fixture instance, decorate your fixture with <code>@one_fixture_per_step</code>.</li>
</ul>
<p>For example</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">one_fixture_per_step</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="nd">@one_fixture_per_step</span>
<span class="k">def</span> <span class="nf">my_fixture</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Simple function-scoped fixture that return a new instance each time&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">usage_counter</span>
    <span class="n">usage_counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">usage_counter</span>
</code></pre></div>


<p>Each step will now use its own fixture instance and the test will succeed (instance 2 will be available at step b).</p>
<div class="admonition note">
<p>When a fixture is decorated with <code>@one_fixture_per_step</code>, the object that is injected in your test function is a transparent proxy of the fixture, so it behaves exactly like the fixture. If for some reason you want to get the "true" inner wrapped object, you can do so using <code>get_underlying_fixture(my_fixture)</code>.</p>
</div>
<h2 id="2-usage-explicit-mode">2. Usage - "explicit" mode<a class="headerlink" href="#2-usage-explicit-mode" title="Permanent link">&para;</a></h2>
<p>In "explicit" mode, things are a bit more complex to write but can be easier to understand because it does not use generators, just simple function calls.</p>
<h3 id="a-basics_1">a- Basics<a class="headerlink" href="#a-basics_1" title="Permanent link">&para;</a></h3>
<p>Like for the other mode, simply decorate your test function with <code>@test_steps</code> and declare what are the steps that will be performed. In addition, put a <code>test_step</code> parameter in your function, that will receive the current step.</p>
<p>The easiest way to use it is to declare each step as a function:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="k">def</span> <span class="nf">step_a</span><span class="p">():</span>
    <span class="c1"># perform this step ...</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step a&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>

<span class="k">def</span> <span class="nf">step_b</span><span class="p">():</span>
    <span class="c1"># perform this step</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_a</span><span class="p">,</span> <span class="n">step_b</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_1</span><span class="p">(</span><span class="n">test_step</span><span class="p">):</span>
    <span class="c1"># Optional: perform step-specific reasoning, for example to select arguments</span>
    <span class="k">if</span> <span class="n">test_step</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;step_a&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calling step a&quot;</span><span class="p">)</span>

    <span class="c1"># Execute the step by calling the test step function</span>
    <span class="n">test_step</span><span class="p">()</span>
</code></pre></div>


<p>Note: as shown above, you can perform some reasoning about the step at hand in <code>test_suite_1</code>, by looking at the <code>test_step</code> object.</p>
<div class="admonition note">
<p class="admonition-title">Custom parameter name</p>
<p>You might want another name than <code>test_step</code> to receive the current step. The <code>test_step_argname</code> argument can be used to change that name.</p>
</div>
<h4 id="variants-other-types">Variants: other types<a class="headerlink" href="#variants-other-types" title="Permanent link">&para;</a></h4>
<p>This mechanism is actually nothing more than a pytest parameter so it has to requirement on the <code>test_step</code> type. It is therefore possible to use other types, for example to declare the test steps as strings instead of function:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_2</span><span class="p">(</span><span class="n">test_step</span><span class="p">):</span>
    <span class="c1"># Execute the step according to name</span>
    <span class="k">if</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;step_a&#39;</span><span class="p">:</span>
        <span class="n">step_a</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;step_b&#39;</span><span class="p">:</span>
        <span class="n">step_b</span><span class="p">()</span>

<span class="o">...</span>
</code></pre></div>


<p>This has pros and cons:</p>
<ul>
<li>(+) you can declare the test suite <em>before</em> the step functions in the python file (better readability !)</li>
<li>(-) you can not use <code>@depends_on</code> to decorate your step functions: you can only rely on shared data container to create dependencies (as explained below)</li>
</ul>
<h3 id="b-auto-skipfail">b- Auto-skip/fail<a class="headerlink" href="#b-auto-skipfail" title="Permanent link">&para;</a></h3>
<p>In this <em>explicit</em> mode <strong>all steps are optional/independent</strong> by default: each of them will be run, whatever the execution result of others. If you wish to change this, you can use the <code>@depends_on</code> decorator to mark a step as to be automatically skipped or failed if some other steps did not run successfully.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">depends_on</span>

<span class="k">def</span> <span class="nf">step_a</span><span class="p">():</span>
    <span class="o">...</span>

<span class="nd">@depends_on</span><span class="p">(</span><span class="n">step_a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">step_b</span><span class="p">():</span>
    <span class="o">...</span>
</code></pre></div>


<p>That way, <code>step_b</code> will now be skipped if <code>step_a</code> does not run successfully. </p>
<p>Note that if you use shared data (see below), you can perform similar, and also more advanced dependency checks, by checking the contents of the shared data and calling <code>pytest.skip()</code> or <code>pytest.fail()</code> according to what is present. See <code>step_b</code> in the example below for an illustration.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>@depends_on</code> decorator is only effective if the decorated step function is used "as is" as an argument in <code>@test_steps()</code>. If a non-direct relation is used, such as using the test step name as argument, you should use a shared data container (see below) to manually create the dependency.</p>
</div>
<h3 id="c-shared-data">c- Shared data<a class="headerlink" href="#c-shared-data" title="Permanent link">&para;</a></h3>
<p>In this <em>explicit</em> mode, by default all steps are independent, therefore they <strong>do not have access to each other's execution results</strong>. To solve this problem, you can add a <code>steps_data</code> argument to your test function. If you do so, a <code>StepsDataHolder</code> object will be injected in this variable, that you can use to store and retrieve results. Simply create fields on it and store whatever you like:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="s1">&#39;step_a&#39;</span><span class="p">,</span> <span class="s1">&#39;step_b&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite_with_shared_results</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># Execute the step with access to the steps_data holder</span>
    <span class="k">if</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;step_a&#39;</span><span class="p">:</span>
        <span class="n">step_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;step_b&#39;</span><span class="p">:</span>
        <span class="n">step_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">step_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># perform this step ...</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step a&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>  <span class="c1"># replace with your logic</span>

    <span class="c1"># intermediate results can be stored in steps_data</span>
    <span class="n">steps_data</span><span class="o">.</span><span class="n">intermediate_a</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>

<span class="k">def</span> <span class="nf">step_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># perform this step, leveraging the previous step&#39;s results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step b&quot;</span><span class="p">)</span>

    <span class="c1"># you can leverage the results from previous steps... </span>
    <span class="c1"># ... or pytest.skip if not relevant</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps_data</span><span class="o">.</span><span class="n">intermediate_a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Step b should only be executed if the text is long enough&quot;</span><span class="p">)</span>

    <span class="n">new_text</span> <span class="o">=</span> <span class="n">steps_data</span><span class="o">.</span><span class="n">intermediate_a</span> <span class="o">+</span> <span class="s2">&quot; ... augmented&quot;</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">56</span>
</code></pre></div>


<h3 id="d-calling-decorated-functions-manually_1">d- Calling decorated functions manually<a class="headerlink" href="#d-calling-decorated-functions-manually_1" title="Permanent link">&para;</a></h3>
<p>In "explicit" mode it is possible to call your test functions outside of pytest runners, exactly the same way <a href="#d-calling-decorated-functions-manually">we saw in generator mode</a>.</p>
<p>An exemple can be found <a href="https://github.com/smarie/python-pytest-steps/blob/master/pytest_steps/tests/test_docs_example_manual_call.py">here</a>.</p>
<h3 id="e-compliance-with-pytest_1">e- Compliance with pytest<a class="headerlink" href="#e-compliance-with-pytest_1" title="Permanent link">&para;</a></h3>
<p>You can add as many <code>@pytest.mark.parametrize</code> and pytest fixtures in your test suite function, it should work as expected: a <strong>new</strong> <code>steps_data</code> object will be created everytime a new parameter/fixture combination is created, and that object will be <strong>shared</strong> across steps with the same parameters and fixtures.</p>
<p>Concerning fixtures, </p>
<ul>
<li>by default all function-scoped fixtures will be "one per step" in this mode (you do not even need to use the <code>@one_fixture_per_step</code> decorator - although it does not hurt).</li>
<li>if you wish a fixture to be shared across several steps, decorate it with <code>@cross_steps_fixture</code>.</li>
</ul>
<p>For example</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">cross_steps_fixture</span>

<span class="n">usage_counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="nd">@cross_steps_fixture</span>
<span class="k">def</span> <span class="nf">my_cool_fixture</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A fixture that returns a new integer every time it is used.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">usage_counter</span>
    <span class="n">usage_counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;created my_fixture </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">usage_counter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">usage_counter</span>

<span class="k">def</span> <span class="nf">step_a</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">step_b</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">)</span>

<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_a</span><span class="p">,</span> <span class="n">step_b</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_params_mode</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">my_cool_fixture</span><span class="p">):</span>
    <span class="c1"># assert that whatever the step, the fixture is the same (shared across steps)</span>
    <span class="k">assert</span> <span class="n">my_cool_fixture</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">test_step</span><span class="p">()</span>
</code></pre></div>


<h2 id="3-usage-with-pytest-harvest">3. Usage with <code>pytest-harvest</code><a class="headerlink" href="#3-usage-with-pytest-harvest" title="Permanent link">&para;</a></h2>
<h3 id="a-enhancing-the-results-df">a- Enhancing the results df<a class="headerlink" href="#a-enhancing-the-results-df" title="Permanent link">&para;</a></h3>
<p>You might already use <a href="https://smarie.github.io/python-pytest-harvest/"><code>pytest-harvest</code></a> to turn your tests into functional benchmarks. When you combine it with <code>pytest_steps</code> you end up with one row in the synthesis table <strong>per step</strong>. For example:</p>
<table>
<thead>
<tr>
<th>test_id</th>
<th>status</th>
<th>duration_ms</th>
<th><strong><em>_</em></strong><em>step_name</em></th>
<th>algo_param</th>
<th>dataset</th>
<th>accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td>test_my_app_bench[A-1-train]</td>
<td>passed</td>
<td>2.00009</td>
<td>train</td>
<td>1</td>
<td>my dataset #A</td>
<td>0.832642</td>
</tr>
<tr>
<td>test_my_app_bench[A-1-score]</td>
<td>passed</td>
<td>0</td>
<td>score</td>
<td>1</td>
<td>my dataset #A</td>
<td>nan</td>
</tr>
<tr>
<td>test_my_app_bench[A-2-train]</td>
<td>passed</td>
<td>1.00017</td>
<td>train</td>
<td>2</td>
<td>my dataset #A</td>
<td>0.0638134</td>
</tr>
<tr>
<td>test_my_app_bench[A-2-score]</td>
<td>passed</td>
<td>0.999928</td>
<td>score</td>
<td>2</td>
<td>my dataset #A</td>
<td>nan</td>
</tr>
<tr>
<td>test_my_app_bench[B-1-train]</td>
<td>passed</td>
<td>0</td>
<td>train</td>
<td>1</td>
<td>my dataset #B</td>
<td>0.870705</td>
</tr>
<tr>
<td>test_my_app_bench[B-1-score]</td>
<td>passed</td>
<td>0</td>
<td>score</td>
<td>1</td>
<td>my dataset #B</td>
<td>nan</td>
</tr>
<tr>
<td>test_my_app_bench[B-2-train]</td>
<td>passed</td>
<td>0</td>
<td>train</td>
<td>2</td>
<td>my dataset #B</td>
<td>0.764746</td>
</tr>
<tr>
<td>test_my_app_bench[B-2-score]</td>
<td>passed</td>
<td>1.0004</td>
<td>score</td>
<td>2</td>
<td>my dataset #B</td>
<td>nan</td>
</tr>
</tbody>
</table>
<p>You might wish to use the provided <code>handle_steps_in_results_df</code> utility method to replace the index with a 2-level multiindex (test id without step, step id).</p>
<h3 id="b-pivoting-the-results-df">b- Pivoting the results df<a class="headerlink" href="#b-pivoting-the-results-df" title="Permanent link">&para;</a></h3>
<p>If you prefer to see one row per test and the step details in columns, this package also provides <em>NEW</em> default <code>[module/session]_results_df_steps_pivoted</code> fixtures to directly get the pivoted version ; and a <code>pivot_steps_on_df</code> utility method to perform the pivot transform easily.</p>
<p>You will for example obtain this kind of pivoted table:</p>
<table>
<thead>
<tr>
<th>test_id</th>
<th>algo_param</th>
<th>dataset</th>
<th>train/status</th>
<th>train/duration_ms</th>
<th>train/accuracy</th>
<th>score/status</th>
<th>score/duration_ms</th>
</tr>
</thead>
<tbody>
<tr>
<td>test_my_app_bench[A-1]</td>
<td>1</td>
<td>my dataset #A</td>
<td>passed</td>
<td>2.00009</td>
<td>0.832642</td>
<td>passed</td>
<td>0</td>
</tr>
<tr>
<td>test_my_app_bench[A-2]</td>
<td>2</td>
<td>my dataset #A</td>
<td>passed</td>
<td>1.00017</td>
<td>0.0638134</td>
<td>passed</td>
<td>0.999928</td>
</tr>
<tr>
<td>test_my_app_bench[B-1]</td>
<td>1</td>
<td>my dataset #B</td>
<td>passed</td>
<td>0</td>
<td>0.870705</td>
<td>passed</td>
<td>0</td>
</tr>
<tr>
<td>test_my_app_bench[B-2]</td>
<td>2</td>
<td>my dataset #B</td>
<td>passed</td>
<td>0</td>
<td>0.764746</td>
<td>passed</td>
<td>1.0004</td>
</tr>
</tbody>
</table>
<h3 id="c-examples">c- Examples<a class="headerlink" href="#c-examples" title="Permanent link">&para;</a></h3>
<p>Two examples are available that should be quite straightforward for those familiar with pytest-harvest:</p>
<ul>
<li><a href="https://github.com/smarie/python-pytest-steps/blob/master/pytest_steps/tests/test_docs_example_with_harvest.py">here</a> an example relying on default fixtures, to show how simple it is to satisfy the most common use cases.</li>
<li><a href="https://github.com/smarie/python-pytest-steps/blob/master/pytest_steps/tests/test_steps_harvest.py">here</a> an advanced example where the custom synthesis is created manually from the dictionary provided by pytest-harvest, thanks to helper methods.</li>
</ul>
<h2 id="main-features-benefits">Main features / benefits<a class="headerlink" href="#main-features-benefits" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Split tests into steps</strong>. Although the best practices in testing are very much in favor of having each test completely independent of the other ones (for example for distributed execution), there is definitely some value in results readability to break down tests into chained sub-tests (steps). The <code>@test_steps</code> decorator provides an intuitive way to do that without forcing any data model (steps can be functions, objects, etc.).</li>
<li><strong>Multi-style</strong>: an <em>explicit</em> mode and a <em>generator</em> mode are supported, developers may wish to use one or the other depending on their coding style or readability target.</li>
<li><strong>Steps can share data</strong>- In <em>generator</em> mode this is out-of-the-box. In <em>explicit</em> mode all steps in the same test suite can share data through the injected <code>steps_data</code> container (name is configurable).</li>
<li><strong>Steps dependencies can be defined</strong>: a <code>@depends_on</code> decorator (<em>explicit</em> mode) or an <code>optional_step</code> context manager (<em>generator</em> mode) allow you to specify that a given test step should be skipped or failed if its dependencies did not complete. </li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.pytest.org/en/latest/parametrize.html">pytest documentation on parametrize</a></li>
<li><a href="https://docs.pytest.org/en/latest/fixture.html">pytest documentation on fixtures</a></li>
<li><a href="https://smarie.github.io/python-pytest-cases/">pytest-cases</a>, to go further and separate test data from test functions</li>
</ul>
<h3 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h3>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie/OVERVIEW#python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-pytest-steps">https://github.com/smarie/python-pytest-steps</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="api_reference/" title="API reference" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API reference
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"search.result.none": "No matching documents", "search.result.other": "# matching documents", "search.result.one": "1 matching document", "clipboard.copied": "Copied to clipboard", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.lang": "en", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "clipboard.copy": "Copy to clipboard"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>